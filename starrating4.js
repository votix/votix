(function(){const CONSTANTS={SHADOW_DOM_FULL_STAR_SELECTOR:'.shadow-full',SHADOW_DOM_EMPTY_SELECTOR:'.shadow-empty',SHADOW_DOM_HOVER_SELECTOR:'.shadow-hover',FIREBASE_APP_SCRIPT:'https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js',FIREBASE_DATABASE_SCRIPT:'https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js',VOTIX_SCRIPT:'https://cdn.jsdelivr.net/gh/votix/votix/starrating4.js',EMPTY_STAR_IMAGE:'https://1.bp.blogspot.com/-pOr9XGwtSJc/Wsjf8ULOIqI/AAAAAAAAAKE/KBh-LUDIn0YzASKf-t7mQo8UNpdHhr2SgCLcBGAs/s1600/pusta.png',FULL_STAR_IMAGE:'https://3.bp.blogspot.com/-QSNdWP4Ijx4/Wsjf7QOUZ4I/AAAAAAAAAJ8/F2nReVG5WfA1rLV3dGcAFMsPOnIQck4YwCLcBGAs/s1600/pelna.png',DEFAULT_FONT:'inherit',LOADER_CLASS:'kozyr-SRS-loader',AVERAGE_CLASS:'.kozyr-SRS-average',VOTES_CLASS:'.kozyr-SRS-votes',DEFAULT_ALIGN:'center',ROTATION_ANIMATION:'@keyframes dawaj {0% {transform: rotate(0deg);} 100% {transform:rotate(360deg);}} .kozyr-SRS-loader ~ div{visibility:hidden;}',DEFAULT_TEXT_SIZE:15,DEFAULT_NUMBER_OF_STARS:5,DEFAULT_AVERAGE_VALUE:'0',CSS_HIDDEN:'hidden',CSS_VISIBLE:'visible',CSS_INLINE_BLOCK:'inline-block',CSS_TRANSPARENT:'transparent',CSS_POINTER:'pointer',CSS_RELATIVE:'relative',CSS_ABSOLUTE:'absolute',CSS_AUTO:'auto',CSS_NONE:'none',CSS_100_PERCENT:'100%',CSS_OPACITY_TRANSITION:'opacity 1s',CSS_PADDING_BOX:'border-box',CSS_BLOCKING_TEXT:'border-box',CSS_INHERIT:'inherit',CSS_BLOCKING_DIV:'display: block;text-align: center;opacity: 0.8;',ERROR_INVALID_URL:'Ошибка Firebase. Неверный URL Firebase',ERROR_URL_MISSING_SLASH:'Ошибка Firebase. Введите URL-адрес вашего Firebase в атрибут "firebaseURL" в вашем скрипте рейтинга.',ERROR_ATTRIBUTE_MISSING:'Ошибка Firebase. Добавьте атрибут firebaseURL="https://YOUR-FIREBASE.firebaseio.com" к вашему скрипту рейтинга.',DOMAIN:'firebaseio.com',LOADING_ANIMATION:'dawaj 1s linear infinite',FONT_FAMILY:{ARIAL:'Arial, Helvetica, sans-serif',VERDANA:'Verdana, Geneva, sans-serif',TAHOMA:'Tahoma, Geneva, sans-serif',PALATINO:"'Palatino Linotype', 'Book Antiqua', Palatino, serif",LUCIDA_GRANDE:"'Lucida Sans Unicode', 'Lucida Grande', sans-serif",TREBUCHET:"'Trebuchet MS', Helvetica, sans-serif",COMIC_SANS:"'Comic Sans MS', cursive, sans-serif",IMPACT:'Impact, Charcoal, sans-serif',LUCIDA_CONSOLE:"'Lucida Console', Monaco, monospace",TIMES_NEW_ROMAN:"'Times New Roman', Times, serif",},};const TEMPLATES={AVERAGE_RATING:'<span class="kozyr-SRS-average">0</span>',BOTTOM_TEXT:'Среднее: <b>$average$</b> / $max$ (<b>$votes$</b> голосов)',};let StarRatingGenerator=typeof StarRatingGenerator==='undefined'?0:StarRatingGenerator+1;function initializeStarRating(index){if(StarRatingGenerator===0&&!document.querySelector(`script[src="${CONSTANTS.FIREBASE_APP_SCRIPT}"]`)){loadScripts();loadStyles()}const ratingElement=document.querySelectorAll('.star-rating-container')[index];if(!ratingElement){console.error(`Star rating element at index ${index}not found.`);return}const config=getConfig(ratingElement);const container=createContainer(config);const loader=createLoader(config);ratingElement.parentNode.insertBefore(container,ratingElement);container.appendChild(loader);const topTextElement=createTopTextElement(config);const bottomTextElement=createBottomTextElement(config);container.appendChild(topTextElement);container.appendChild(bottomTextElement);const starsContainer=createStarsContainer(config);container.appendChild(starsContainer);for(let i=1;i<=config.numberOfStars;i++){const star=createStar(i,config);starsContainer.appendChild(star)}container.appendChild(bottomTextElement);updateStars(container,0,config.starSize);if(config.firebaseURL.indexOf(CONSTANTS.DOMAIN)<0){container.textContent=config.firebaseURL}else{initFirebase(container,loader,starsContainer,topTextElement,config)}function getConfig(ratingElement){let ratingName=ratingElement.getAttribute('ratingName');if(!ratingName||ratingName==='___'){let href=location.href.split('?')[0].split('#')[0].replace(location.protocol+'//','');if(href.slice(-1)==='/'||href.slice(-1)==='.'){href=href.slice(0,-1)}href=href.replace(/\./g,'_').replace(/\//g,'__').replace(/\,/g,'___').replace(/\s/g,'');ratingName=href}ratingName=ratingName.replace(/\s/g,'_').replace(/\#/g,'-').replace(/\./g,'-').replace(/\@/g,'-').replace(/\!/g,'-').replace(/\$/g,'-').replace(/\%/g,'-').replace(/\&/g,'-').replace(/\(/g,'-').replace(/\)/g,'-');const emptyStarImg=ratingElement.getAttribute('emptyStarImg')||CONSTANTS.EMPTY_STAR_IMAGE;const fullStarImg=ratingElement.getAttribute('fullStarImg')||CONSTANTS.FULL_STAR_IMAGE;let hoverStarImg=ratingElement.getAttribute('hoverStarImg');if(!hoverStarImg)hoverStarImg=fullStarImg;let starSize=ratingElement.getAttribute('starSize');if(!starSize||Number(starSize)<0||isNaN(starSize))starSize=CONSTANTS.DEFAULT_TEXT_SIZE;starSize=Number(starSize);let firebaseURL=ratingElement.getAttribute('firebaseURL');if(!firebaseURL)firebaseURL=CONSTANTS.ERROR_ATTRIBUTE_MISSING;let align=ratingElement.getAttribute('align');if(align!=='left'&&align!=='right')align=CONSTANTS.DEFAULT_ALIGN;let textSize=ratingElement.getAttribute('textSize');if(!textSize||Number(textSize)<0||isNaN(textSize))textSize=CONSTANTS.DEFAULT_TEXT_SIZE;textSize=Number(textSize);const textColor=ratingElement.getAttribute('textColor')||'black';let fontFamily=ratingElement.getAttribute('fontFamily');switch(fontFamily){case'Georgia':case'Georgia, serif':fontFamily='Georgia, serif';break;case'Verdana':case CONSTANTS.FONT_FAMILY.VERDANA:fontFamily=CONSTANTS.FONT_FAMILY.VERDANA;break;case'Times New Roman':case CONSTANTS.FONT_FAMILY.TIMES_NEW_ROMAN:fontFamily=CONSTANTS.FONT_FAMILY.TIMES_NEW_ROMAN;break;case'Arial':case CONSTANTS.FONT_FAMILY.ARIAL:fontFamily=CONSTANTS.FONT_FAMILY.ARIAL;break;case'Trebuchet':case CONSTANTS.FONT_FAMILY.TREBUCHET:fontFamily=CONSTANTS.FONT_FAMILY.TREBUCHET;break;case'Comic Sans':case CONSTANTS.FONT_FAMILY.COMIC_SANS:fontFamily=CONSTANTS.FONT_FAMILY.COMIC_SANS;break;case'Lucida Sans':case CONSTANTS.FONT_FAMILY.LUCIDA_GRANDE:fontFamily=CONSTANTS.FONT_FAMILY.LUCIDA_GRANDE;break;case'Palatino':case CONSTANTS.FONT_FAMILY.PALATINO:fontFamily=CONSTANTS.FONT_FAMILY.PALATINO;break;case'Lucida Console':case CONSTANTS.FONT_FAMILY.LUCIDA_CONSOLE:fontFamily=CONSTANTS.FONT_FAMILY.LUCIDA_CONSOLE;break;case'Courier New':case"'Courier New', Courier, monospace":fontFamily="'Courier New', Courier, monospace";break;case'Impact':case CONSTANTS.FONT_FAMILY.IMPACT:fontFamily=CONSTANTS.FONT_FAMILY.IMPACT;break;default:fontFamily=CONSTANTS.DEFAULT_FONT;break}const readonly=ratingElement.getAttribute('readonly')==='readonly';const topText=ratingElement.getAttribute('topText')||'Рейтинг:';const bottomText=ratingElement.getAttribute('bottomText')||TEMPLATES.BOTTOM_TEXT.replace('$average$',CONSTANTS.DEFAULT_AVERAGE_VALUE).replace('$votes$','<span class="kozyr-SRS-votes">0</span>').replace('$max$',5);let numberOfStars=Number(ratingElement.getAttribute('numberOfStars'));if(numberOfStars<1||isNaN(numberOfStars))numberOfStars=CONSTANTS.DEFAULT_NUMBER_OF_STARS;const thankYouText=ratingElement.getAttribute('thankYouText')||'Спасибо за ваш голос';const currentUrl=location.href.replace(/\#.*/g,'').replace(/\?.*/g,'').replace(/\./g,'_').replace(/\//g,'__');const URL=currentUrl===''?'index':currentUrl;let firebase_URL=ratingElement.getAttribute('firebaseURL');if(!firebase_URL){firebase_URL=CONSTANTS.ERROR_ATTRIBUTE_MISSING}else if(firebase_URL===''){firebase_URL=CONSTANTS.ERROR_URL_MISSING_SLASH}else if(firebase_URL.indexOf(CONSTANTS.DOMAIN)!==0){firebase_URL=CONSTANTS.ERROR_INVALID_URL}else if(firebase_URL.slice(-1)!=='/'){firebase_URL=firebase_URL+'/'}return{ratingName,emptyStarImg,fullStarImg,hoverStarImg,starSize,firebaseURL,align,textSize,textColor,fontFamily,readonly,topText,bottomText,numberOfStars,thankYouText,URL,firebase_URL,}}function createContainer(config){const container=document.createElement('div');container.setAttribute('ratingName',config.ratingName);container.style.textAlign=config.align;container.style.position=CONSTANTS.CSS_RELATIVE;container.oncontextmenu=(event)=>{event.preventDefault();return false};return container}function createLoader(config){const loader=document.createElement('div');loader.classList.add(CONSTANTS.LOADER_CLASS);loader.style.border='6px solid #f3f3f3';loader.style.borderTop='6px solid #3498db';loader.style.borderRadius='50%';loader.style.width='25px';loader.style.height='25px';loader.style.backgroundColor=CONSTANTS.CSS_TRANSPARENT;if(config.align===CONSTANTS.DEFAULT_ALIGN){loader.style.margin='auto'}else if(config.align==='right'){loader.style.marginLeft=`calc(100%-${config.starSize*config.numberOfStars}px)`}loader.style.animation=CONSTANTS.LOADING_ANIMATION;loader.style.position=CONSTANTS.CSS_ABSOLUTE;loader.style.top='50%';loader.style.left='50%';loader.style.marginTop='-12.5px';loader.style.marginLeft='-12.5px';return loader}function createTopTextElement(config){const topTextElement=document.createElement('div');topTextElement.textContent=config.topText;topTextElement.style.fontSize=`${config.textSize}px`;topTextElement.style.lineHeight='1.2';topTextElement.style.fontFamily=config.fontFamily;topTextElement.style.textAlign=config.align;topTextElement.style.color=config.textColor;return topTextElement}function createBottomTextElement(config){let bottomText=config.bottomText.replace('$average$',CONSTANTS.DEFAULT_AVERAGE_VALUE).replace('$votes$','<span class="kozyr-SRS-votes">0</span>').replace('$max$',config.numberOfStars);const bottomTextElement=document.createElement('div');bottomTextElement.style.fontSize=`${config.textSize}px`;bottomTextElement.style.lineHeight='1.2';bottomTextElement.style.fontFamily=config.fontFamily;bottomTextElement.style.textAlign=config.align;bottomTextElement.style.color=config.textColor;bottomTextElement.innerHTML=bottomText;return bottomTextElement}function createStarsContainer(config){const starsContainer=document.createElement('div');starsContainer.style.width=`${config.starSize*config.numberOfStars}px`;starsContainer.style.display=CONSTANTS.CSS_INLINE_BLOCK;return starsContainer}function createStar(i,config){const star=document.createElement('div');star.style.display=CONSTANTS.CSS_INLINE_BLOCK;star.style.width=`${config.starSize}px`;star.style.cursor=!localStorage.getItem('starRating_'+config.ratingName)&&!config.readonly?CONSTANTS.CSS_POINTER:CONSTANTS.CSS_INHERIT;star.setAttribute('data-value',i);if(!config.readonly){star.onclick=()=>{if(!localStorage.getItem('starRating_'+config.ratingName)){const stars=container.getElementsByTagName('div');for(let j=0;j<stars.length;j++){if(stars[j].className!=CONSTANTS.LOADER_CLASS){if(Number(stars[j].getAttribute('data-value'))<=i){stars[j].querySelector(CONSTANTS.SHADOW_DOM_FULL_STAR_SELECTOR).style.width='0%';stars[j].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).style.width='0%';stars[j].querySelector(CONSTANTS.SHADOW_DOM_HOVER_SELECTOR).style.width='0%'}else{stars[j].querySelector(CONSTANTS.SHADOW_DOM_FULL_STAR_SELECTOR).style.width='0%';stars[j].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).style.width='100%';stars[j].querySelector(CONSTANTS.SHADOW_DOM_HOVER_SELECTOR).style.width='0%';stars[j].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).querySelector('img').style.margin='0 0 0 0'}}}if(config.topText!==''){topTextElement.textContent=i+'/'+config.numberOfStars}}else{container.textContent=config.firebaseURL.replace(/\$userRating\$/g,localStorage.getItem('starRating_'+config.ratingName));container.style.cursor=CONSTANTS.CSS_INHERIT}}}const fullStar=document.createElement('div');fullStar.style.display=CONSTANTS.CSS_INLINE_BLOCK;fullStar.style.position=CONSTANTS.CSS_RELATIVE;const emptyStar=document.createElement('div');emptyStar.style.display=CONSTANTS.CSS_INLINE_BLOCK;emptyStar.style.overflow=CONSTANTS.CSS_HIDDEN;const hoverStar=document.createElement('div');hoverStar.style.display=CONSTANTS.CSS_INLINE_BLOCK;hoverStar.style.position=CONSTANTS.CSS_RELATIVE;const emptyStarImage=document.createElement('img');emptyStarImage.style.opacity=0;emptyStarImage.style.width=`${config.starSize}px`;const fullStarImageContainer=document.createElement('img');fullStarImageContainer.src=config.fullStarImg;fullStarImageContainer.style.opacity=0;fullStarImageContainer.style.width=`${config.starSize}px`;const hoverStarImageContainer=document.createElement('img');hoverStarImageContainer.src=config.hoverStarImg;hoverStarImageContainer.style.opacity=0;hoverStarImageContainer.style.width=`${config.starSize}px`;emptyStarImage.src=config.emptyStarImg;fullStar.appendChild(fullStarImageContainer);emptyStar.appendChild(emptyStarImage);hoverStar.appendChild(hoverStarImageContainer);star.appendChild(fullStar);star.appendChild(emptyStar);star.appendChild(hoverStar);return star}function initFirebase(container,loader,starsContainer,topTextElement,config){const firebaseConfig={databaseURL:config.firebase_URL,};const currentUrl=location.href.replace(/\#.*/g,'').replace(/\?.*/g,'').replace(/\./g,'_').replace(/\//g,'__');const URL=currentUrl===''?'index':currentUrl;try{const app=firebase.initializeApp(firebaseConfig,config.ratingName+StarRatingGenerator);const databaseRef=app.database().ref('StarRatingSystem/'+config.URL+'/'+config.ratingName);databaseRef.on('value',(snapshot)=>{const data=snapshot.val();if(!data){const initialData={OO:0,O0:0,};databaseRef.set(initialData)}updateStars(container,data.OO*config.numberOfStars,config.starSize);if(container.contains(loader)){loader.remove()}starsContainer.onmouseenter=()=>{updateStars(container,data.OO*config.numberOfStars,config.starSize);topTextElement.textContent=config.topText};const averageElement=document.querySelectorAll('.kozyr-SRS-average');averageElement.forEach((averageElement)=>(averageElement.textContent=Math.round(data.OO*config.numberOfStars*4)/4));const votesElement=document.querySelectorAll('.kozyr-SRS-votes');votesElement.forEach((votesElement)=>(votesElement.textContent=data.O0));if(!config.readonly){const starElements=document.querySelectorAll('.star-rating-container');starElements.forEach((starElement,starIndex)=>{starElement.onclick=()=>{if(!localStorage.getItem('starRating_'+config.ratingName)){const averageRating=(data.OO*data.O0+(starIndex+1)/config.numberOfStars)/(data.O0+1);const newData={OO:averageRating,O0:data.O0+1,};databaseRef.set(newData);localStorage.setItem('starRating_'+config.ratingName,starIndex+1);const allStars=document.querySelectorAll('.star-rating-container');allStars.forEach((star)=>{star.style.cursor=CONSTANTS.CSS_INHERIT});showThankYouMessage(config.thankYouText,container,starIndex+1);topTextElement.textContent=config.topText}else{showThankYouMessage(config.firebaseURL,container,localStorage.getItem('starRating_'+config.ratingName))}}})}})}catch(e){console.log("Error loading Firebase")}}}function loadScripts(){const firebaseAppScript=document.createElement('script');firebaseAppScript.src=CONSTANTS.FIREBASE_APP_SCRIPT;document.head.appendChild(firebaseAppScript);firebaseAppScript.onload=()=>{const firebaseDatabaseScript=document.createElement('script');firebaseDatabaseScript.src=CONSTANTS.FIREBASE_DATABASE_SCRIPT;document.head.appendChild(firebaseDatabaseScript)}}function loadStyles(){const styleElement=document.createElement('style');styleElement.textContent=CONSTANTS.ROTATION_ANIMATION;document.head.appendChild(styleElement)}function updateStars(element,rating,starSize){const stars=element.getElementsByTagName('div');for(let i=0;i<stars.length;i++){if(i<=rating){if(i<Math.floor(rating)){stars[i].querySelector(CONSTANTS.SHADOW_DOM_FULL_STAR_SELECTOR).style.width=CONSTANTS.CSS_100_PERCENT;stars[i].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).style.width='0px'}else{let partialStarValue=rating-Math.floor(rating);let width=Math.round(partialStarValue*starSize);stars[i].querySelector(CONSTANTS.SHADOW_DOM_FULL_STAR_SELECTOR).style.width=width+'px';stars[i].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).style.width=starSize-width+'px';stars[i].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).querySelector('img').margin=`0 0 0-${width}px`}}else{stars[i].querySelector(CONSTANTS.SHADOW_DOM_FULL_STAR_SELECTOR).style.width='0%';stars[i].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).style.width=CONSTANTS.CSS_100_PERCENT;stars[i].querySelector(CONSTANTS.SHADOW_DOM_EMPTY_SELECTOR).querySelector('img').margin='0 0 0 0'}}}function showThankYouMessage(message,ratingElement,userRating){const thankYouDiv=document.createElement('div');thankYouDiv.textContent=message.replace(/\$userRating\$/g,userRating);thankYouDiv.style.position=CONSTANTS.CSS_ABSOLUTE;thankYouDiv.style.background=CONSTANTS.CSS_TRANSPARENT;thankYouDiv.style.border='1px solid #e0e0e0';thankYouDiv.style.borderRadius='7px';thankYouDiv.style.padding='3px 7px';thankYouDiv.style.lineHeight='1.2';thankYouDiv.style.zIndex='9999999';thankYouDiv.style.opacity='0';thankYouDiv.style.boxSizing='border-box';thankYouDiv.style.whiteSpace='nowrap';thankYouDiv.style.transition=CONSTANTS.CSS_OPACITY_TRANSITION;document.body.appendChild(thankYouDiv);const elementRect=ratingElement.getBoundingClientRect();setTimeout(()=>{thankYouDiv.style.opacity='1';let left;if(ratingElement.style.textAlign==='right'){left=window.scrollX+elementRect.right+ratingElement.offsetWidth-200+'px'}else if(ratingElement.style.textAlign===CONSTANTS.DEFAULT_ALIGN){left=window.scrollX+elementRect.left+ratingElement.offsetWidth/2-100+'px'}else{left=window.scrollX+elementRect.left+'px'}thankYouDiv.style.left=left;thankYouDiv.style.top=(elementRect.top>thankYouDiv.offsetHeight?window.scrollY+elementRect.top-thankYouDiv.offsetHeight:window.scrollY+elementRect.top+thankYouDiv.offsetHeight)+'px'},10);setTimeout(()=>{thankYouDiv.style.opacity='0';setTimeout(()=>{document.body.removeChild(thankYouDiv)},1000)},5555)}function initialize(index){if(typeof firebase!=='undefined'&&typeof firebase.initializeApp==='function'&&typeof firebase.database==='function'){initializeStarRating(index)}else{setTimeout(()=>{initialize(index)},50)}}const ratingElements=document.querySelectorAll('.star-rating-container');ratingElements.forEach((item,index)=>{item.classList.add('bsrgl_'+index);item.classList.remove('star-rating-container');item.classList.add('star-rating-container')})initialize(StarRatingGenerator)})();
