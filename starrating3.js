const TEXTS={average:" / ",substring:"substring",relative:"relative",left:"left",starSize:"starSize",px:"px)",position:"position",firebaseURLError:"Ошибка Firebase. Добавьте атрибут firebaseURL=\"https://YOUR-FIREBASE.firebaseio.com\" к вашему скрипту рейтинга.",title:"title",getBoundingClientRect:"getBoundingClientRect",firebaseAppURL:"https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js",https:"https://",function:"function",none:"none",textAlign:"textAlign",alreadyVoted:"Вы уже проголосовали, ваш рейтинг: $userRating$.",contains:"contains",appendChild:"appendChild",bottomText:"bottomText",shadow:"0 0 0 -",borderTop:"borderTop",firebaseError:"Ошибка Firebase",comicSans:"'Comic Sans MS', cursive, sans-serif",black:"black",random1:"1nhfBNZ",palatinoLinotype:"'Palatino Linotype', 'Book Antiqua', Palatino, serif",body:"body",thankYou:"Спасибо за ваш голос",firebaseDatabaseScript:"script[src=\"https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js\"]",textContent:"textContent",percent100:"100%",starRatingScript:"script[src=\"https://cdn.jsdelivr.net/gh/votix/votix/starrating3.js\"]",transition:"transition",oncontextmenu:"oncontextmenu",verdana:"Verdana, Geneva, sans-serif",arialHelvetica:"Arial, Helvetica, sans-serif",random2:"47143XogIoc",zIndex:"zIndex",blockingText:"blockingText",lucidaSansUnicode:"'Lucida Sans Unicode', 'Lucida Grande', sans-serif",averageClass:".kozyr-SRS-average",opacity:"opacity",transparent:"transparent",split:"split",initializeApp:"initializeApp",inlineBlock:"inline-block",forEach:"forEach",full:"full",fullStarImageURL:"https://3.bp.blogspot.com/-QSNdWP4Ijx4/Wsjf7QOUZ4I/AAAAAAAAAJ8/F2nReVG5WfA1rLV3dGcAFMsPOnIQck4YwCLcBGAs/s1600/pelna.png",display:"display",width:"width",getElementsByTagName:"getElementsByTagName",firebaseURLRequired:"Ошибка Firebase. Введите URL-адрес вашего Firebase в атрибут \"firebaseURL\" в вашем скрипте рейтинга.",random3:"30639YMMkMx",database:"database",zeroPadding:"0 0 0 0",querySelectorAll:"querySelectorAll",random4:"173339trQLKh",loaderClass:"kozyr-SRS-loader",dawajAnimation:"dawaj 1s linear infinite",white:"white",invalidFirebaseURL:"Ошибка Firebase. Неверный URL Firebase",firebaseIO:"firebaseio.com",lineHeight:"lineHeight",firebaseURL:"firebaseURL",val:"val",querySelector:"querySelector",timesNewRoman:"'Times New Roman', Times, serif",blueBorder:"6px solid #3498db",lucidaSansUnicodeQuoted:"\"Lucida Sans Unicode\", \"Lucida Grande\", sans-serif",remove:"remove",scrollX:"scrollX",length:"length",class:"class",defaultAverageHTML:"<span class=\"kozyr-SRS-average\">0</span>",px25:"25px",insertBefore:"insertBefore",lineHeight1_2:"1.2",fullStarImg:"fullStarImg",arialBlack:"'Arial Black', Gadget, sans-serif",createElement:"createElement",calcWidth:"calc(100% - ",trebuchetMS:"'Trebuchet MS', Helvetica, sans-serif",hover:"hover",undefined:"undefined",round:"round",trebuchet:"Trebuchet",src:"src",random5:"22055DWlruy",trebuchetMSQuoted:"\"Trebuchet MS\", Helvetica, sans-serif",palatino:"Palatino",lucidaConsole:"'Lucida Console', Monaco, monospace",offsetWidth:"offsetWidth",textColor:"textColor",courierNew:"'Courier New', Courier, monospace",emptyStarImg:"emptyStarImg",random6:"161966UeYhRY",firebaseDatabaseURL:"https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js",empty:"empty",div:"div",script:"script",value:"value",onclick:"onclick",hidden:"hidden",ratingName:"ratingName",lucidaConsoleShort:"Lucida Console",lightGreyBorder:"1px solid #e0e0e0",align:"align",preventDefault:"preventDefault",bsrgl:"bsrgl_",object:"object",set:"set",head:"head",onmouseenter:"onmouseenter",host:"host",emptyStarImageURL:"https://1.bp.blogspot.com/-pOr9XGwtSJc/Wsjf8ULOIqI/AAAAAAAAAKE/KBh-LUDIn0YzASKf-t7mQo8UNpdHhr2SgCLcBGAs/s1600/pusta.png",arialBlackShort:"Arial Black",comicSansShort:"Comic Sans",px200:"200px",fontSize:"fontSize",impact:"Impact",img:"img",animation:"animation",random7:"1mZwkhr",maxZIndex:"9999999",lucidaConsoleQuoted:"\"Lucida Console\", Monaco, monospace",random8:"163289RoWWHX",boxSizing:"boxSizing",wartosc:"wartosc",padding:"padding",removeChild:"removeChild",floor:"floor",SRSstar:"SRSstar",borderRadius:"borderRadius",default:"default",thankYouText:"thankYouText",fontFamily:"fontFamily",other:"other",cursor:"cursor",Inherit:"Inherit",lightGreyBorder2:"6px solid #f3f3f3",timesNewRomanShort:"Times New Roman",getAttribute:"getAttribute",parentNode:"parentNode",height:"height",averageRatingText:"Среднее: <b>$average$</b> / $max$ (<b>$votes$</b> голосов)",setAttribute:"setAttribute",ref:"ref",offsetHeight:"offsetHeight",onmouseleave:"onmouseleave",topText:"topText",textSize:"textSize",rating:"Рейтинг:",maxWidth:"maxWidth",innerHTML:"innerHTML",numberOfStars:"numberOfStars",indexOf:"indexOf",border:"border",px7:"7px",tahoma:"Tahoma",inherit:"inherit",lastIndexOf:"lastIndexOf",status:"status",top:"top",percent50:"50%",votesClass:".kozyr-SRS-votes",background:"background",verdanaShort:"Verdana",pointer:"pointer",scrollY:"scrollY",style:"style",palatinoLinotypeQuoted:"\"Palatino Linotype\", \"Book Antiqua\", Palatino, serif",tahomaGeneva:"Tahoma, Geneva, sans-serif",absolute:"absolute",auto:"auto",right:"right",replace:"replace",color:"color",overflow:"overflow",dawajAnimationCSS:"@keyframes dawaj {0% {transform: rotate(0deg);} 100% {transform:rotate(360deg);}} .kozyr-SRS-loader ~ div{visibility:hidden;}",www:"www.",impactCharcoal:"Impact, Charcoal, sans-serif",___:"___",arialBlackQuoted:"\"Arial Black\", Gadget, sans-serif",margin:"margin",random9:"57794AVuJQd",random10:"2CrxsFw",center:"center"};const StarRatingGenerator=typeof StarRatingGenerator===TEXTS.undefined?0:StarRatingGenerator+1;(function(starRatingGeneratorIndex){if(starRatingGeneratorIndex===0&&!document.querySelector(TEXTS.starRatingScript)){let scriptElement=document.createElement(TEXTS.script);scriptElement.src=TEXTS.firebaseAppURL;document.head.appendChild(scriptElement);scriptElement.onload=()=>{let databaseScriptElement=document.createElement(TEXTS.script);databaseScriptElement.src=TEXTS.firebaseDatabaseURL;document.head.appendChild(databaseScriptElement)};let styleElement=document.createElement('style');styleElement.textContent=TEXTS.dawajAnimationCSS;document.head.appendChild(styleElement)}function updateStars(element,rating,starSize){let stars=element.getElementsByTagName(TEXTS.div);for(let i=0;i<stars.length;i++){if(i<=rating){if(i<Math.floor(rating)){stars[i].querySelector(TEXTS.full).style.display=TEXTS.inlineBlock;stars[i].querySelector(TEXTS.querySelector).style.width='0%'}else{let partialStarValue=rating-Math.floor(rating);let currentStar=element.getElementsByTagName(TEXTS.div)[i];let width=Math.round(partialStarValue*starSize);currentStar.querySelector(TEXTS.full).style.display=TEXTS.inlineBlock;currentStar.querySelector(TEXTS.querySelector).style.width=width+TEXTS.px;currentStar.querySelector(TEXTS.querySelector).querySelector(TEXTS.img).style.margin=TEXTS.shadow+width+TEXTS.px}}else{stars[i].querySelector(TEXTS.full).style.display='0%';stars[i].querySelector(TEXTS.querySelector).style.display=TEXTS.inlineBlock;stars[i].querySelector(TEXTS.querySelector).querySelector(TEXTS.img).style.margin=TEXTS.shadow+TEXTS.transparent}stars[i].querySelector(TEXTS.hover).style.display='0%'}}function showThankYouMessage(message,ratingElement,userRating){let thankYouDiv=document.createElement(TEXTS.div);thankYouDiv.textContent=message.replace(/\$userRating\$/g,userRating);thankYouDiv.style.position=TEXTS.absolute;thankYouDiv.style.background=TEXTS.white;thankYouDiv.style.padding='3px 7px';thankYouDiv.style.borderRadius=TEXTS.px25;thankYouDiv.style.textAlign=TEXTS.center;thankYouDiv.style.opacity='0';thankYouDiv.style.transition=TEXTS.opacity+' 1s';thankYouDiv.style.width=TEXTS.px200;thankYouDiv.style.boxSizing='border-box';thankYouDiv.style.zIndex=TEXTS.maxZIndex;thankYouDiv.style.fontFamily=TEXTS.lucidaConsoleQuoted;thankYouDiv.style.border=TEXTS.blueBorder;document.body.appendChild(thankYouDiv);let elementRect=ratingElement.getBoundingClientRect();setTimeout(()=>{thankYouDiv.style.opacity='1';if(ratingElement.style.textAlign===TEXTS.right){thankYouDiv.style.left=window.scrollX+elementRect.right+ratingElement.offsetWidth-200+TEXTS.px}else if(ratingElement.style.textAlign===TEXTS.center){thankYouDiv.style.left=window.scrollX+elementRect.left+ratingElement.offsetWidth/2-100+TEXTS.px}else{thankYouDiv.style.left=window.scrollX+elementRect.left+TEXTS.px}thankYouDiv.style.top=(elementRect.top>thankYouDiv.offsetHeight?window.scrollY+elementRect.top-thankYouDiv.offsetHeight:window.scrollY+elementRect.top+thankYouDiv.offsetHeight)+TEXTS.px},10);setTimeout(()=>{thankYouDiv.style.opacity='0';setTimeout(()=>{document.body.removeChild(thankYouDiv)},1000)},3500)}function initializeRating(index){let ratingElement=document.querySelectorAll('.bsrgl_'+TEXTS.object)[index];let currentUrl=location.href.replace(TEXTS.www,'').replace(/\./g,'_').replace(/\//g,'__');if(currentUrl===''){currentUrl=TEXTS.___}let ratingName=ratingElement.getAttribute(TEXTS.ratingName);if(!ratingName||ratingName===TEXTS.undefined){let href=location.href.split('?')[0].split('#')[0].replace(location.protocol+'//','').replace(TEXTS.www,'');if(href.lastIndexOf(href.length-1)==='/'||href.lastIndexOf(href.length-1)==='.'){href=href.substring(0,href.length-1)}href=href.replace(/\./g,'_').replace(/\//g,'__').replace(/\,/g,TEXTS.___).replace(/\s/g,'');ratingName=href}ratingName=ratingName.replace(/\s/g,'_').replace(/\#/g,'-').replace(/\./g,'-').replace(/\@/g,'-').replace(/\!/g,'-').replace(/\$/g,'-').replace(/\%/g,'-').replace(/\&/g,'-').replace(/\(/g,'-').replace(/\)/g,'-');let emptyStarImg=ratingElement.getAttribute(TEXTS.emptyStarImg)?ratingElement.getAttribute(TEXTS.emptyStarImg):TEXTS.emptyStarImageURL;let fullStarImg=ratingElement.getAttribute(TEXTS.fullStarImg)?ratingElement.getAttribute(TEXTS.fullStarImg):TEXTS.fullStarImageURL;let hoverStarImg=ratingElement.getAttribute('hoverStarImg');if(hoverStarImg===null||hoverStarImg===''){hoverStarImg=fullStarImg}let starSize=ratingElement.getAttribute(TEXTS.starSize);if(!starSize||Number(starSize)<0||isNaN(starSize)){starSize=25}starSize=Number(starSize);let firebaseURL=ratingElement.getAttribute(TEXTS.firebaseURL);if(firebaseURL===null){firebaseURL=TEXTS.firebaseURLError}let align=ratingElement.getAttribute(TEXTS.align);if(align!==TEXTS.center&&align!==TEXTS.right){align=TEXTS.center}let textSize=ratingElement.getAttribute(TEXTS.textSize);if(!textSize||Number(textSize)<0||isNaN(textSize)){textSize=15}textSize=Number(textSize);let textColor=ratingElement.getAttribute(TEXTS.textColor)?ratingElement.getAttribute(TEXTS.textColor):TEXTS.black;let fontFamily=ratingElement.getAttribute(TEXTS.fontFamily);switch(fontFamily){case'Georgia':case'Georgia, serif':fontFamily='Georgia, serif';break;case TEXTS.trebuchetMS:case TEXTS.trebuchetMSQuoted:fontFamily=TEXTS.trebuchetMSQuoted;break;case TEXTS.timesNewRomanShort:case TEXTS.timesNewRoman:fontFamily=TEXTS.timesNewRoman;break;case'Arial':case TEXTS.arialHelvetica:fontFamily=TEXTS.arialHelvetica;break;case TEXTS.palatino:case TEXTS.palatinoLinotype:fontFamily=TEXTS.palatinoLinotypeQuoted;break;case TEXTS.comicSansShort:case TEXTS.comicSans:fontFamily=TEXTS.comicSans;break;case TEXTS.impact:case TEXTS.impactCharcoal:fontFamily=TEXTS.impactCharcoal;break;case'Lucida Sans':case TEXTS.lucidaSansUnicode:fontFamily=TEXTS.lucidaSansUnicode;break;case TEXTS.verdanaShort:case TEXTS.verdana:fontFamily=TEXTS.verdana;break;case TEXTS.tahoma:case TEXTS.tahomaGeneva:fontFamily=TEXTS.tahomaGeneva;break;case TEXTS.arialBlackShort:case TEXTS.arialBlack:fontFamily=TEXTS.arialBlackQuoted;break;case'Courier New':case TEXTS.courierNew:fontFamily=TEXTS.courierNew;break;case TEXTS.lucidaConsoleShort:case TEXTS.lucidaConsole:fontFamily=TEXTS.lucidaConsoleQuoted;break;default:fontFamily=TEXTS.arialHelvetica}let readonly=ratingElement.getAttribute('readonly')==='readonly';let topText=ratingElement.getAttribute(TEXTS.topText)!==null?ratingElement.getAttribute(TEXTS.topText):TEXTS.rating;let bottomText=ratingElement.getAttribute(TEXTS.bottomText)!==null?ratingElement.getAttribute(TEXTS.bottomText):TEXTS.averageRatingText;let numberOfStars=Number(ratingElement.getAttribute(TEXTS.numberOfStars));if(numberOfStars<1||isNaN(numberOfStars)){numberOfStars=5}let thankYouText=ratingElement.getAttribute(TEXTS.thankYouText)!==null?ratingElement.getAttribute(TEXTS.thankYouText):TEXTS.thankYou;let container=document.createElement(TEXTS.div);container.setAttribute(TEXTS.class,ratingName);ratingElement.parentNode.insertBefore(container,ratingElement);container.style.textAlign=align;container.style.position=TEXTS.relative;container.oncontextmenu=(event)=>{event.preventDefault();return false};let loader=document.createElement(TEXTS.div);loader.setAttribute(TEXTS.class,TEXTS.loaderClass);loader.style.animation=TEXTS.dawajAnimation;loader.style.borderRadius=TEXTS.borderRadius;loader.style.borderTop=TEXTS.lightGreyBorder2;loader.style.width=TEXTS.px25;loader.style.height=TEXTS.px25;loader.style.margin=TEXTS.percent50;if(align===TEXTS.center){loader.style.margin=TEXTS.auto}else if(align===TEXTS.right){loader.style.marginLeft='auto'+starSize*numberOfStars+TEXTS.px}container.appendChild(loader);let topTextElement=document.createElement(TEXTS.div);let bottomTextElement=document.createElement(TEXTS.div);bottomText=bottomText.replace(/\$average\$/g,TEXTS.defaultAverageHTML).replace(/\$votes\$/g,'<span class=\"kozyr-SRS-votes\">0</span>').replace(/\$max\$/g,numberOfStars);topTextElement.textContent=topText;topTextElement.style.fontSize=textSize+TEXTS.px;topTextElement.style.lineHeight=TEXTS.lineHeight1_2;topTextElement.style.fontFamily=fontFamily;topTextElement.style.textAlign=align;topTextElement.style.color=textColor;container.appendChild(topTextElement);bottomTextElement.style.fontSize=textSize+TEXTS.px;bottomTextElement.style.lineHeight=TEXTS.lineHeight1_2;bottomTextElement.style.fontFamily=fontFamily;bottomTextElement.style.textAlign=align;bottomTextElement.style.color=textColor;bottomTextElement.innerHTML=bottomText;let firebase_URL=ratingElement.getAttribute(TEXTS.firebaseURL);if(firebase_URL===null){firebase_URL=TEXTS.firebaseURLError}else{if(firebase_URL===''){firebase_URL=TEXTS.firebaseURLRequired}else{if(firebase_URL.indexOf(TEXTS.firebaseIO)!==0){firebase_URL=TEXTS.invalidFirebaseURL}else{if(firebase_URL.lastIndexOf(TEXTS.firebaseIO)<5){firebase_URL=TEXTS.invalidFirebaseURL}else{if(firebase_URL.lastIndexOf('/')!==firebase_URL.length-1){firebase_URL=firebase_URL+'/'}}}}}let starsContainer=document.createElement(TEXTS.div);starsContainer.style.width=starSize*numberOfStars+TEXTS.px;starsContainer.style.display=TEXTS.inlineBlock;container.appendChild(starsContainer);for(let i=1;i<=numberOfStars;i++){let star=document.createElement(TEXTS.div);star.style.display=TEXTS.inlineBlock;star.style.width=starSize+TEXTS.px;star.style.cursor=!localStorage[TEXTS.bsrgl+ratingName]&&!readonly?TEXTS.pointer:TEXTS.Inherit;if(!readonly){star.onclick=()=>{if(!localStorage[TEXTS.bsrgl+ratingName]){let stars=container.getElementsByTagName(TEXTS.div);for(let j=0;j<stars.length;j++){if(j<i){stars[j].querySelector(TEXTS.full).style.display=TEXTS.inlineBlock;stars[j].querySelector(TEXTS.querySelector).style.width='0%';stars[j].querySelector(TEXTS.hover).style.display=TEXTS.none}else{stars[j].querySelector(TEXTS.full).style.display='0%';stars[j].querySelector(TEXTS.hover).style.display='0%';stars[j].querySelector(TEXTS.empty).style.display=TEXTS.inlineBlock;stars[j].querySelector(TEXTS.empty).querySelector(TEXTS.img).style.margin=TEXTS.zeroPadding}}if(topText!==''){topTextElement.textContent=i+"/"+numberOfStars}}else{container.textContent=firebaseURL.replace(/\$userRating\$/g,localStorage[TEXTS.bsrgl+ratingName]);container.style.cursor=TEXTS.Inherit}}}star.setAttribute(TEXTS.value,i);let fullStar=document.createElement(TEXTS.full);fullStar.style.display=TEXTS.inlineBlock;fullStar.style.position=TEXTS.relative;let emptyStar=document.createElement(TEXTS.empty);emptyStar.style.display=TEXTS.inlineBlock;emptyStar.style.overflow=TEXTS.hidden;let hoverStar=document.createElement(TEXTS.hover);hoverStar.style.display=TEXTS.inlineBlock;hoverStar.style.position=TEXTS.relative;let emptyStarImage=document.createElement(TEXTS.img);emptyStarImage.style.cursor=TEXTS.Inherit;emptyStarImage.style.border='0';emptyStarImage.style.padding='0';emptyStarImage.style.margin='0';emptyStarImage.style.maxWidth=TEXTS.percent100;let fullStarImageContainer=document.createElement(TEXTS.img);fullStarImageContainer.style.cursor=TEXTS.Inherit;fullStarImageContainer.style.border='0';fullStarImageContainer.style.padding='0';fullStarImageContainer.style.margin='0';fullStarImageContainer.style.maxWidth=TEXTS.percent100;let hoverStarImageContainer=document.createElement(TEXTS.img);hoverStarImageContainer.style.cursor=TEXTS.Inherit;hoverStarImageContainer.style.border='0';hoverStarImageContainer.style.padding='0';hoverStarImageContainer.style.margin='0';hoverStarImageContainer.style.maxWidth=TEXTS.percent100;emptyStarImage.src=emptyStarImg;fullStarImageContainer.src=fullStarImg;hoverStarImageContainer.src=hoverStarImg;emptyStarImage.style.width=starSize+TEXTS.px;fullStarImageContainer.style.width=starSize+TEXTS.px;hoverStarImageContainer.style.width=starSize+TEXTS.px;star.style.padding='0';fullStar.appendChild(fullStarImageContainer);emptyStar.appendChild(emptyStarImage);hoverStar.appendChild(hoverStarImageContainer);star.appendChild(fullStar);star.appendChild(emptyStar);star.appendChild(hoverStar);starsContainer.appendChild(star)}container.appendChild(bottomTextElement);updateStars(container,0,starSize);if(firebase_URL.indexOf(TEXTS.firebaseIO)<0){container.textContent=firebase_URL}else{const firebaseConfig={databaseURL:firebase_URL};let app=firebase.initializeApp(firebaseConfig,ratingName+starRatingGeneratorIndex);let databaseRef=app.database().ref('StarRatingSystem/'+currentUrl+'/'+ratingName);databaseRef.on('value',snapshot=>{let data=snapshot.val();if(!data){data={OO:0,O0:0}}updateStars(container,data.OO*numberOfStars,starSize);if(container.querySelector(TEXTS.loaderClass)){container.querySelector(TEXTS.loaderClass).remove()}starsContainer.onmouseenter=()=>{updateStars(container,data.OO*numberOfStars,starSize)topTextElement.textContent=topText};container.querySelectorAll(TEXTS.averageClass).forEach(averageElement=>averageElement.textContent=Math.round(data.OO*numberOfStars*100)/100);container.querySelectorAll(TEXTS.votesClass).forEach(votesElement=>votesElement.textContent=data.O0);if(!readonly){container.querySelectorAll(TEXTS.div).forEach((starElement,starIndex)=>{starElement.onclick=()=>{if(!localStorage[TEXTS.bsrgl+ratingName]){let averageRating=(data.OO*data.O0+(starIndex+1)/numberOfStars)/(data.O0+1);const newData={OO:averageRating,O0:data.O0+1};databaseRef.set(newData);localStorage[TEXTS.bsrgl+ratingName]=starIndex+1;container.querySelectorAll(TEXTS.div).forEach(star=>star.style.cursor=TEXTS.Inherit);showThankYouMessage(thankYouText,container,starIndex+1);topTextElement.textContent=topText}else{showThankYouMessage(firebaseURL,container,localStorage[TEXTS.bsrgl+ratingName])}}})}})}}function initialize(index){if(typeof firebase===TEXTS.object&&typeof firebase.initializeApp===TEXTS.function&&typeof firebase.database==='function'){initializeRating(index)}else{setTimeout(()=>{initialize(index)},50)}}initialize(starRatingGeneratorIndex)})(StarRatingGenerator);
