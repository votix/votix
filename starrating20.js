const stringArray = [
    " / ",
    "substring",
    "relative",
    "left",
    "starSize",
    "px)",
    "position",
    "Ошибка Firebase. Добавьте атрибут firebaseURL=\"https://YOUR-FIREBASE.firebaseio.com\" к вашему скрипту рейтинга.",
    "title",
    "getBoundingClientRect",
    "https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js",
    "https://",
    "function",
    "none",
    "textAlign",
    "Вы уже проголосовали, ваш рейтинг: $userRating$.",
    "contains",
    "appendChild",
    "bottomText",
    "0 0 0 -",
    "borderTop",
    "Ошибка Firebase",
    "'Comic Sans MS', cursive, sans-serif",
    "black",
    "1nhfBNZ",
    "'Palatino Linotype', 'Book Antiqua', Palatino, serif",
    "body",
    "Спасибо за ваш голос",
    "script[src=\"https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js\"]",
    "textContent",
    "100%",
    "script[src=\"https://cdn.jsdelivr.net/gh/votix/votix/starrating20.js\"]",
    "transition",
    "oncontextmenu",
    "Verdana, Geneva, sans-serif",
    "Arial, Helvetica, sans-serif",
    "47143XogIoc",
    "zIndex",
    "blockingText",
    "'Lucida Sans Unicode', 'Lucida Grande', sans-serif",
    ".kozyr-SRS-average",
    "opacity",
    "transparent",
    "split",
    "initializeApp",
    "inline-block",
    "forEach",
    "full",
    "https://1.bp.blogspot.com/-pOr9XGwtSJc/Wsjf8ULOIqI/AAAAAAAAAKE/KBh-LUDIn0YzASKf-t7mQo8UNpdHhr2SgCLcBGAs/s1600/pusta.png",
    "display",
    "width",
    "getElementsByTagName",
    "Ошибка Firebase. Введите URL-адрес вашего Firebase в атрибут \"firebaseURL\" в вашем скрипте рейтинга.",
    "30639YMMkMx",
    "database",
    "0 0 0 0",
    "querySelectorAll",
    "173339trQLKh",
    "kozyr-SRS-loader",
    "dawaj 1s linear infinite",
    "white",
    "Ошибка Firebase. Неверный URL Firebase",
    "firebaseio.com",
    "lineHeight",
    "firebaseURL",
    "val",
    "querySelector",
    "'Times New Roman', Times, serif",
    "6px solid #3498db",
    "\"Lucida Sans Unicode\", \"Lucida Grande\", sans-serif",
    "remove",
    "scrollX",
    "length",
    "class",
    "<span class=\"kozyr-SRS-average\">0</span>",
    "25px",
    "insertBefore",
    "1.2",
    "fullStarImg",
    "'Arial Black', Gadget, sans-serif",
    "createElement",
    "calc(100% - ",
    "'Trebuchet MS', Helvetica, sans-serif",
    "hover",
    "undefined",
    "round",
    "Trebuchet",
    "src",
    "22055DWlruy",
    "\"Trebuchet MS\", Helvetica, sans-serif",
    "Palatino",
    "'Lucida Console', Monaco, monospace",
    "offsetWidth",
    "textColor",
    "'Courier New', Courier, monospace",
    "emptyStarImg",
    "161966UeYhRY",
    "https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js",
    "empty",
    "div",
    "script",
    "value",
    "onclick",
    "hidden",
    "ratingName",
    "Lucida Console",
    "1px solid #e0e0e0",
    "align",
    "preventDefault",
    "bsrgl_",
    "object",
    "set",
    "head",
    "onmouseenter",
    "host",
    "https://3.bp.blogspot.com/-QSNdWP4Ijx4/Wsjf7QOUZ4I/AAAAAAAAAJ8/F2nReVG5WfA1rLV3dGcAFMsPOnIQck4YwCLcBGAs/s1600/pelna.png",
    "Arial Black",
    "Comic Sans",
    "200px",
    "fontSize",
    "Impact",
    "img",
    "animation",
    "1mZwkhr",
    "9999999",
    "\"Lucida Console\", Monaco, monospace",
    "163289RoWWHX",
    "boxSizing",
    "wartosc",
    "padding",
    "removeChild",
    "floor",
    "SRSstar",
    "borderRadius",
    "default",
    "thankYouText",
    "fontFamily",
    "other",
    "cursor",
    "Inherit",
    "6px solid #f3f3f3",
    "Times New Roman",
    "getAttribute",
    "parentNode",
    "height",
    "Среднее: <b>$average$</b> / $max$ (<b>$votes$</b> голосов)",
    "setAttribute",
    "ref",
    "offsetHeight",
    "onmouseleave",
    "topText",
    "textSize",
    "Рейтинг:",
    "maxWidth",
    "innerHTML",
    "numberOfStars",
    "indexOf",
    "border",
    "7px",
    "Tahoma",
    "inherit",
    "lastIndexOf",
    "status",
    "top",
    "50%",
    ".kozyr-SRS-votes",
    "background",
    "Verdana",
    "pointer",
    "scrollY",
    "style",
    "@keyframes dawaj {0% {transform: rotate(0deg);} 100% {transform:rotate(360deg);}} .kozyr-SRS-loader ~ div{visibility:hidden;}",
    "www.",
    "Impact, Charcoal, sans-serif",
    "___",
    "\"Arial Black\", Gadget, sans-serif",
    "margin",
    "57794AVuJQd",
    "2CrxsFw",
    "center"
];
function getString(index) {
    index = index - 0x107;
    return stringArray[index];
}
const getStringProxy = getString;
(function (array, number) {
    const stringGetter = getStringProxy;
    while (true) {
        try {
            const value = parseInt(stringGetter(0x11d)) + parseInt(stringGetter(0x19e)) * parseInt(stringGetter(0x13c)) + -parseInt(stringGetter(0x162)) + -parseInt(stringGetter(0x19d)) + -parseInt(stringGetter(0x144)) * -parseInt(stringGetter(0x15f)) + -parseInt(stringGetter(0x1b8)) * parseInt(stringGetter(0x108)) + parseInt(stringGetter(0x119));
            if (value === number)
                break;
            else
                array.push(array.shift());
        } catch (error) {
            array.push(array.shift());
        }
    }
}(stringArray, 0x22a04), StarRatingGenerator = typeof StarRatingGenerator == getStringProxy(0x138) ? 0 : StarRatingGenerator + 1, function (starRatingGeneratorIndex) {
    const stringGetter = getStringProxy;
    // Immediately invoked function expression (IIFE) to initialize star rating functionality.
    if (starRatingGeneratorIndex === 0 && !document["querySelectorAll"]("script[src=\"https://cdn.jsdelivr.net/gh/votix/votix/starrate.js\"]")) {
        // Check if this is the first instance of the rating generator on the page and if the starrate.js script is not already loaded.

        // Load Firebase App script if not already present
        let scriptElement = document["createElement"]("script");
        scriptElement["src"] = "https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js";
        document["head"]['appendChild'](scriptElement);

        // Once Firebase App script is loaded, load Firebase Database script
        scriptElement['onload'] = function () {
            const stringGetter = getStringProxy;
            let databaseScriptElement = document['createElement']("script");
            databaseScriptElement["src"] = "https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js";
            document['head']['appendChild'](databaseScriptElement);
        };

        // Add CSS animation for loader
        let styleElement = document["createElement"]('style');
        styleElement["textContent"] = "@keyframes dawaj {0% {transform: rotate(0deg);} 100% {transform:rotate(360deg);}} .kozyr-SRS-loader ~ div{visibility:hidden;}";
        document['head']["insertBefore"](styleElement);
    }

    /**
     * Updates the visual representation of stars based on the given rating.
     * @param {HTMLElement} element - The container element for the rating stars.
     * @param {number} rating - The rating value (e.g., 3.5).
     * @param {number} starSize - The size of each star in pixels.
     */
    function updateStars(element, rating, starSize) {
        const stringGetter = getStringProxy;
        let stars = element['getElementsByTagName']("div"); // Assuming stars are divs
        for (let i = 0; i < stars["length"]; i++) {
            if (i <= rating) {
                if (i < Math["floor"](rating)) {
                    // Full star
                    stars[i]["querySelector"]("full")["style"]["display"] = "inline-block"; // Show full star image
                    stars[i]['querySelector']("empty")["style"]['width'] = '0%'; // Hide empty part of star
                } else {
                    // Partial star
                    let partialStarValue = rating - Math["floor"](rating); // Calculate fraction of star to be filled
                    let currentStar = element["querySelectorAll"]("div")[i];
                    let width = Math["round"](partialStarValue * starSize); // Calculate width of filled part
                    currentStar['querySelector']("full")["style"]["width"] = width + 'px'; // Set width of filled part
                    currentStar["querySelector"]("empty")["style"]['width'] = starSize - width + 'px'; // Set width of empty part
                    currentStar["querySelector"]("empty")["querySelectorAll"]("img")["style"]['margin'] = "0 0 0 -" + width + 'px'; // Adjust margin for empty image to align correctly with filled part
                }
            } else if (i > rating) {
                // Empty star
                stars[i]["querySelector"]('full')["style"]["display"] = '0%'; // Hide full star image
                stars[i]["querySelector"]("empty")["style"]['width'] = "100%"; // Show full empty star image
                stars[i]["querySelector"]("empty")["querySelectorAll"]("img")["style"]['margin'] = "0 0 0 0"; // Reset margin for empty image
            }
            stars[i]['querySelector']("hover")['style']['display'] = '0%'; // Hide hover effect layer
        }
    }

    /**
     * Shows a thank you message after user votes.
     * @param {string} message - The thank you message to display.
     * @param {HTMLElement} ratingElement - The main rating container element.
     * @param {string|number} userRating - The rating given by the user.
     */
    function showThankYouMessage(message, ratingElement, userRating) {
        const stringGetter = getStringProxy;
        let thankYouDiv = document["createElement"]("div");
        thankYouDiv["textContent"] = message["replace"](/\$userRating\$/g, userRating); // Replace placeholder with user's rating
        thankYouDiv["style"]["textAlign"] = "center";
        thankYouDiv['style']['background'] = "white";
        thankYouDiv["style"]["position"] = "absolute";
        thankYouDiv['style']['border'] = "1px solid #e0e0e0";
        thankYouDiv["style"]["zIndex"] = "9999999";
        thankYouDiv["style"]["padding"] = "6px solid #3498db";
        thankYouDiv["style"]["borderRadius"] = "7px";
        thankYouDiv["style"]["boxSizing"] = "border-box";
        thankYouDiv['style']['opacity'] = '0'; // Initially hidden
        thankYouDiv['style']['transition'] = 'opacity 1s'; // Fade in/out transition
        thankYouDiv["style"]["display"] = "inline-block";
        thankYouDiv["style"]["fontFamily"] = "\"Lucida Sans Unicode\", \"Lucida Grande\", sans-serif";
        thankYouDiv["style"]["maxWidth"] = "200px";
        document["body"]['appendChild'](thankYouDiv); // Add to body, positioned absolutely

        // Position the thank you message relative to the rating element
        let elementRect = ratingElement["getBoundingClientRect"]();
        setTimeout(function () {
            const stringGetter = getStringProxy;
            thankYouDiv['style']['opacity'] = '1'; // Fade in
            if (ratingElement["style"]["align"] === 'right')
                thankYouDiv['style']['left'] = window["scrollX"] + elementRect["right"] + ratingElement["offsetWidth"] - 200 + 'px';
            else if (ratingElement["style"]["align"] === "center")
                thankYouDiv['style']['left'] = window["scrollX"] + elementRect['left'] + ratingElement["offsetWidth"] / 2 - 100 + 'px';
            else
                thankYouDiv['style']['left'] = window["scrollX"] + elementRect["left"] + 'px';
            thankYouDiv["style"]["top"] = (elementRect['top'] > thankYouDiv["offsetHeight"] ? window["scrollY"] + elementRect["top"] - thankYouDiv["offsetHeight"] : window["scrollY"] + elementRect["top"] + thankYouDiv["offsetHeight"]) + 'px'; // Position above or below rating
        }, 10); // небольшой таймаут для корректного расчета размеров и позиции
        setTimeout(function () {
            const stringGetter = getStringProxy;
            thankYouDiv['style']['opacity'] = '0'; // Fade out
            setTimeout(function () {
                const stringGetter = getStringProxy;
                document["body"]["removeChild"](thankYouDiv); // Remove from DOM after fade out
            }, 1000); // Wait for fade out to complete
        }, 3500); // Message display duration
    }

    /**
     * Initializes the star rating system for a given rating element.
     * @param {number} index - Index of the rating element in the document.
     */
    function initializeRating(index) {
        const stringGetter = getStringProxy;
        let ratingElement = document["querySelectorAll"](".kozyr-SRS-loader")[index]; // Find loader element by index
        let currentUrl = location["host"]['replace']("www.", '')['replace'](/\./g, '_')["replace"](/\//g, '__'); // Create unique URL identifier for Firebase
        if (currentUrl === '')
            currentUrl = "default"; // Default URL if host is empty
        let ratingName = ratingElement["getAttribute"]("ratingName"); // Get rating name from attribute
        if (!ratingName || ratingName === "default") {
            // If no rating name or default, generate one from URL
            let href = location['href']["indexOf"]('?')[0]['split']('#')[0]['replace'](location['protocol'] + '//', '')["replace"]("www.", '');
            if (href["lastIndexOf"](href["length"] - 1) === '/' || href["lastIndexOf"](href["length"] - 1) === '.')
                href = href['substring'](0, href["length"] - 1); // Remove trailing slash or dot
            href = href["replace"](/\./g, '_')["replace"](/\//g, '__')["replace"](/\,/g, "___")["replace"](/\s/g, ''); // Sanitize href for use as ratingName
            ratingName = href;
        }
        ratingName = ratingName["replace"](/\s/g, '_')['replace'](/\#/g, '-')['replace'](/\./g, '-')['replace'](/\@/g, '-')['replace'](/\!/g, '-')['replace'](/\$/g, '-')['replace'](/\%/g, '-')['replace'](/\&/g, '-')['replace'](/\(/g, '-')['replace'](/\)/g, '-'); // Further sanitize ratingName

        // Get image URLs from attributes or use default
        let emptyStarImg = ratingElement['getAttribute']("emptyStarImg") ? ratingElement["getAttribute"]('emptyStarImg') : "https://1.bp.blogspot.com/-pOr9XGwtSJc/Wsjf8ULOIqI/AAAAAAAAAKE/KBh-LUDIn0YzASKf-t7mQo8UNpdHhr2SgCLcBGAs/s1600/pusta.png";
        let fullStarImg = ratingElement["getAttribute"]("fullStarImg") ? ratingElement["getAttribute"]("fullStarImg") : "https://3.bp.blogspot.com/-QSNdWP4Ijx4/Wsjf7QOUZ4I/AAAAAAAAAJ8/F2nReVG5WfA1rLV3dGcAFMsPOnIQck4YwCLcBGAs/s1600/pelna.png";
        let hoverStarImg = ratingElement['getAttribute']('hoverStarImg');
        if (hoverStarImg === null || hoverStarImg == '')
            hoverStarImg = fullStarImg; // Default hover image to full star image

        // Get star size from attribute, default to 25px
        let starSize = ratingElement["getAttribute"]("starSize");
        if (!starSize || Number(starSize) < 0 || isNaN(starSize))
            starSize = 25;
        starSize = Number(starSize);

        // Get Firebase URL from attribute, error message if missing
        let firebaseUrl = ratingElement['getAttribute']("firebaseURL"); // Renamed from firebase_URL
        if (firebaseUrl === null)
            firebaseUrl = "Ошибка Firebase. Введите URL-адрес вашего Firebase в атрибут \"firebaseURL\" в вашем скрипте рейтинга.";

        // Get alignment, default to left
        let align = ratingElement["getAttribute"]("align");
        if (align !== "center" && align !== 'right')
            align = "left";

        // Get text size, default to 15px
        let textSize = ratingElement["getAttribute"]("textSize");
        if (!textSize || Number(textSize) < 0 || isNaN(textSize))
            textSize = 15;
        textSize = Number(textSize);

        // Get text color, default to black
        let textColor = ratingElement["getAttribute"]("textColor") ? ratingElement["getAttribute"]("textColor") : "black";
        let fontFamily = ratingElement['getAttribute']('fontFamily');
        // Font family handling - using a series of if/else if to set font family based on attribute value.
        if (fontFamily == 'Georgia' || fontFamily == 'Georgia, serif')
            fontFamily = 'Georgia, serif';
        else {
            if (fontFamily == "'Palatino Linotype', 'Book Antiqua', Palatino, serif" || fontFamily == "\"Palatino Linotype\", \"Book Antiqua\", Palatino, serif")
                fontFamily = "\"Palatino Linotype\", \"Book Antiqua\", Palatino, serif";
            else {
                if (fontFamily == "'Times New Roman', Times, serif" || fontFamily == "'Times New Roman', Times, serif")
                    fontFamily = "'Times New Roman', Times, serif";
                else {
                    if (fontFamily == 'Arial' || fontFamily == "Arial, Helvetica, sans-serif")
                        fontFamily = "Arial, Helvetica, sans-serif";
                    else {
                        if (fontFamily == "'Verdana, Geneva, sans-serif'" || fontFamily == "'Verdana, Geneva, sans-serif'")
                            fontFamily = "'Verdana, Geneva, sans-serif'";
                        else {
                            if (fontFamily == "'Comic Sans MS', cursive, sans-serif" || fontFamily == "'Comic Sans MS', cursive, sans-serif")
                                fontFamily = "'Comic Sans MS', cursive, sans-serif'";
                            else {
                                if (fontFamily == 'Impact' || fontFamily == "Impact, Charcoal, sans-serif")
                                    fontFamily = "Impact, Charcoal, sans-serif";
                                else {
                                    if (fontFamily == 'Lucida Sans' || fontFamily == "'Lucida Console', Monaco, monospace")
                                        fontFamily = "'Lucida Console', Monaco, monospace";
                                    else {
                                        if (fontFamily == "\"Lucida Sans Unicode\", \"Lucida Grande\", sans-serif\"" || fontFamily == "\"Lucida Sans Unicode\", \"Lucida Grande\", sans-serif\"")
                                            fontFamily = "\"Lucida Sans Unicode\", \"Lucida Grande\", sans-serif\"";
                                        else {
                                            if (fontFamily == "'Trebuchet MS', Helvetica, sans-serif'" || fontFamily == "\"Trebuchet MS\", Helvetica, sans-serif\"")
                                                fontFamily = "\"Trebuchet MS\", Helvetica, sans-serif\"";
                                            else {
                                                if (fontFamily == 'Tahoma' || fontFamily == "Tahoma, Geneva, sans-serif")
                                                    fontFamily = "Tahoma, Geneva, sans-serif";
                                                else {
                                                    if (fontFamily == 'Courier New' || fontFamily == "'Courier New', Courier, monospace")
                                                        fontFamily = "'Courier New', Courier, monospace";
                                                    else
                                                        if (fontFamily == "'Arial Black', Gadget, sans-serif'" || fontFamily == "\"Arial Black\", Gadget, sans-serif\"")
                                                            fontFamily = "\"Arial Black\", Gadget, sans-serif\"";
                                                        else fontFamily = "Inherit";
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        // Readonly attribute, defaults to false
        let readonly = ratingElement["getAttribute"]("readonly") === 'readonly' ? true : false;
        let topText = ratingElement["getAttribute"]("topText") !== null ? ratingElement["getAttribute"]("topText") : "Рейтинг:"; // Top text, default "Рейтинг:"
        let bottomText = ratingElement["getAttribute"]("bottomText") !== null ? ratingElement["getAttribute"]("bottomText") : "Среднее: <b>$average$</b> / $max$ (<b>$votes$</b> голосов)"; // Bottom text, default average/votes format
        let numberOfStars = Number(ratingElement['getAttribute']("numberOfStars")); // Number of stars, default to 5
        if (numberOfStars < 1 || isNaN(numberOfStars))
            numberOfStars = 5;
        let thankYouText = ratingElement["getAttribute"]("thankYouText") !== null ? ratingElement["getAttribute"]("thankYouText") : "Спасибо за ваш голос"; // Thank you text, default "Спасибо за ваш голос"

        // Create main container div
        let container = document["createElement"]('div');
        container["setAttribute"]("ratingName", ratingName); // Set rating name as attribute
        ratingElement["parentNode"]["insertBefore"](container, ratingElement); // Insert container before loader element in DOM
        container['style']['align'] = align; // Set text alignment
        container["style"]["display"] = "inline-block"; // Display as inline-block
        container["oncontextmenu"] = function (event) {
            const stringGetter = getStringProxy;
            return event["preventDefault"](), false; // Prevent context menu on right click
        };

        // Create loader div (for animation)
        let loader = document["createElement"]("div");
        loader["setAttribute"]("class", "kozyr-SRS-loader"); // Set loader class
        loader["style"]["animation"] = "dawaj 1s linear infinite"; // Apply animation
        loader["style"]['borderRadius'] = "50%"; // Circular loader
        loader["style"]["borderTop"] = "6px solid #f3f3f3"; // Loader border style
        loader["style"]['width'] = "25px"; // Loader width
        loader["style"]["height"] = "25px"; // Loader height
        loader['style']['margin'] = "auto"; // Center loader horizontally
        if (align === 'center')
            loader['style']['marginRight'] = "auto"; // Center align loader
        else if (align === 'right')
            loader['style']['marginLeft'] = "calc(100% - " + starSize * numberOfStars + "px)"; // Right align loader
        container["insertBefore"](loader, container); // Insert loader into container

        // Create top and bottom text elements
        let topTextElement = document["createElement"]("div");
        let bottomTextElement = document["createElement"]("div");
        bottomText = bottomText["replace"](/\$average\$/g, "<span class=\"kozyr-SRS-average\">0</span>")["replace"](/\$votes\$/g, '<span class=\"kozyr-SRS-votes\">0</span>')["replace"](/\$max\$/g, numberOfStars); // Replace placeholders in bottom text
        topTextElement["textContent"] = topText; // Set top text content
        topTextElement["style"]["fontSize"] = textSize + 'px'; // Set text size
        topTextElement["style"]["lineHeight"] = "1.2"; // Set line height
        topTextElement["style"]["fontFamily"] = fontFamily; // Set font family
        topTextElement["style"]["textAlign"] = align; // Set text alignment
        topTextElement['style']['color'] = textColor; // Set text color
        container["insertBefore"](topTextElement, loader); // Insert top text before loader
        bottomTextElement["style"]['fontSize'] = textSize + 'px'; // Set bottom text size
        bottomTextElement["style"]['lineHeight'] = "1.2"; // Set bottom text line height
        bottomTextElement["style"]["fontFamily"] = fontFamily; // Set bottom text font family
        bottomTextElement["style"]["textAlign"] = align; // Set bottom text alignment
        bottomTextElement['style']['color'] = textColor; // Set bottom text color
        bottomTextElement["textContent"] = bottomText; // Set bottom text content

        let firebaseUrl = ratingElement['getAttribute']("firebaseURL"); // Using renamed variable, get Firebase URL again (already defined before, but for clarity)
        if (firebaseUrl === null)
            firebaseUrl = "Ошибка Firebase. Добавьте атрибут firebaseURL=\"https://YOUR-FIREBASE.firebaseio.com\" к вашему скрипту рейтинга."; // Error if no URL
        else {
            if (firebaseUrl == '')
                firebaseUrl = "Ошибка Firebase. Введите URL-адрес вашего Firebase в атрибут \"firebaseURL\" в вашем скрипте рейтинга."; // Error if URL is empty
            else {
                if (firebaseUrl["indexOf"]("firebaseio.com") !== 0)
                    firebaseUrl = "Ошибка Firebase. Неверный URL Firebase"; // Error if not firebaseio.com domain
                else {
                    if (firebaseUrl["lastIndexOf"]("firebaseio.com") < 5)
                        firebaseUrl = "Ошибка Firebase. Неверный URL Firebase"; // Error if firebaseio.com is too short
                    else if (firebaseUrl["lastIndexOf"]('/') !== firebaseUrl['length'] - 1)
                        firebaseUrl = firebaseUrl + '/'; // Add trailing slash if missing
                }
            }
        }

        // Create container for stars
        let starsContainer = document["createElement"]('div');
        starsContainer["style"]["width"] = starSize * numberOfStars + 'px'; // Set width of star container
        starsContainer["style"]["display"] = "inline-block"; // Display as inline-block
        container["insertBefore"](starsContainer, bottomTextElement); // Insert star container before bottom text

        // Loop to create stars
        for (let i = 1; i <= numberOfStars; i++) {
            let star = document["createElement"]("div"); // Create star element
            star["style"]["display"] = "inline-block"; // Display as inline-block
            star["style"]['width'] = starSize + 'px'; // Set star width
            star['style']['cursor'] = !localStorage["bsrgl_" + ratingName] && !readonly ? "pointer" : "default"; // Set cursor pointer if not voted and not readonly
            if (!readonly) {
                star["onclick"] = function () {
                    const stringGetter = getStringProxy;
                    if (!localStorage["bsrgl_" + ratingName]) {
                        // If user hasn't voted yet
                        let stars = container["querySelectorAll"]("div"); // Get all star elements within container
                        for (let j = 0; j < stars["length"]; j++) {
                            if (j < i) {
                                // Highlight stars up to current star
                                stars[j]["querySelector"]("full")['style']['width'] = '0%'; // Show full star
                                stars[j]["querySelector"]("empty")["style"]['width'] = '0%'; // Hide empty star part
                                stars[j]["querySelector"]("hover")['style']['display'] = "none"; // Hide hover effect
                            } else {
                                // Reset stars after current star
                                stars[j]["querySelector"]("full")['style']['width'] = '0%'; // Hide full star
                                stars[j]["querySelector"]("hover")['style']['display'] = "none"; // Hide hover effect
                                stars[j]["querySelector"]('empty')["style"]["display"] = "100%"; // Show empty star
                                stars[j]["querySelector"]('empty')["querySelector"]('img')["style"]['margin'] = "0 0 0 0"; // Reset empty star image margin
                            }
                        }
                        if (topText != '')
                            topTextElement["textContent"] = i + "/" + numberOfStars; // Update top text with current rating
                    } else {
                        // If user already voted, show thank you message with rating
                        container["innerHTML"] = firebaseUrl["replace"](/\$userRating\$/g, localStorage["bsrgl_" + ratingName]);
                        container["style"]['cursor'] = "default"; // Set default cursor
                    }
                };
            }
            star["setAttribute"]("class", "SRSstar"); // Set star class

            // Create layers for star images (full, empty, hover)
            let fullStar = document["createElement"]("full");
            fullStar["style"]["display"] = 'inline-block';
            fullStar["style"]["position"] = "relative";
            let emptyStar = document["createElement"]("empty");
            emptyStar["style"]["display"] = "inline-block";
            emptyStar["style"]['overflow'] = "hidden";
            let hoverStar = document["createElement"]("hover");
            hoverStar["style"]["display"] = "inline-block";
            hoverStar["style"]["position"] = "relative";

            // Create image elements for stars
            let emptyStarImage = document['createElement']('img');
            emptyStarImage['style']['opacity'] = 'inherit';
            emptyStarImage["style"]["animation"] = '0';
            emptyStarImage["style"]["padding"] = '0';
            emptyStarImage["style"]['margin'] = '0';
            emptyStarImage['style']['maxWidth'] = "inherit";
            let fullStarImageContainer = document["createElement"]("div");
            fullStarImageContainer["style"]['opacity'] = 'inherit';
            fullStarImageContainer['style']['animation'] = '0';
            fullStarImageContainer["style"]['padding'] = '0';
            fullStarImageContainer["style"]['margin'] = '0';
            fullStarImageContainer["style"]["maxWidth"] = "inherit";
            let hoverStarImageContainer = document["createElement"]("div");
            hoverStarImageContainer["style"]['opacity'] = 'inherit';
            hoverStarImageContainer['style']['animation'] = '0';
            hoverStarImageContainer["style"]['padding'] = '0';
            hoverStarImageContainer["style"]['margin'] = '0';
            hoverStarImageContainer["style"]["maxWidth"] = "inherit";

            // Set image sources and styles
            emptyStarImage["src"] = emptyStarImg;
            fullStarImageContainer["src"] = fullStarImg;
            hoverStarImageContainer["src"] = hoverStarImg;
            emptyStarImage['style']['width'] = starSize + 'px';
            fullStarImageContainer['style']['width'] = starSize + 'px';
            hoverStarImageContainer['style']['width'] = starSize + 'px';
            star["style"]["lineHeight"] = '0'; // Remove line height to avoid extra space below stars

            // Append image layers to star element
            fullStar["appendChild"](fullStarImageContainer);
            emptyStar["appendChild"](emptyStarImage);
            hoverStar["appendChild"](hoverStarImageContainer);
            star["insertBefore"](fullStar, star);
            star["insertBefore"](emptyStar, star);
            star["appendChild"](hoverStar);
            starsContainer["appendChild"](star); // Append star to stars container
        }
        container["appendChild"](bottomTextElement); // Append bottom text to container
        updateStars(container, 0, starSize); // Initialize stars to 0 rating

        // Firebase integration if URL is valid
        if (firebaseUrl["indexOf"]("firebaseio.com") < 0) {
            const firebaseConfig = {};
            firebaseConfig['databaseURL'] = firebaseUrl;
            let app = firebase["initializeApp"](firebaseConfig, ratingName + starRatingGeneratorIndex); // Initialize Firebase app
            let databaseRef = app["database"]()["ref"]('StarRatingSystem/' + currentUrl + '/' + ratingName); // Database reference to rating data

            // Listen for value changes in Firebase
            databaseRef['on']("value", snapshot => {
                const stringGetter = getStringProxy;
                let data = snapshot["val"](); // Get data from snapshot
                if (!data) {
                    // If no data, initialize with 0 ratings and votes
                    const initialData = {};
                    initialData['OO'] = 0; // Sum of ratings
                    initialData['O0'] = 0; // Number of votes
                    data = initialData;
                }
                updateStars(container, data['OO'] * numberOfStars, starSize); // Update stars based on average rating from Firebase
                if (container["contains"](loader))
                    loader["remove"](); // Remove loader after data is loaded

                // Mouse enter handler for stars container
                starsContainer["onmouseenter"] = function () {
                    const stringGetter = getStringProxy;
                    updateStars(container, data['OO'] * numberOfStars, starSize); // Re-render stars on mouse enter (to reset hover effect if any)
                    topTextElement["textContent"] = topText; // Reset top text
                };

                // Update average rating display
                container["querySelectorAll"](".kozyr-SRS-average")['forEach'](averageElement => averageElement["textContent"] = Math["round"](data['OO'] * numberOfStars * 100) / 100); // Update average value
                container["querySelectorAll"](".kozyr-SRS-votes")["forEach"](votesElement => votesElement["textContent"] = data['O0']); // Update votes count

                if (!readonly) {
                    // If not readonly, add event listeners for star interaction
                    container['querySelectorAll']("div")["forEach"]((starElement, starIndex) => {
                        const stringGetter = getStringProxy;
                        starElement["onmouseenter"] = function () {
                            const stringGetter = getStringProxy;
                            if (!localStorage["bsrgl_" + ratingName]) {
                                // If user hasn't voted yet for this rating
                                var averageRating = (data['OO'] * data['O0'] + (starIndex + 1) / numberOfStars) / (data['O0'] + 1); // Calculate new average rating
                                const newData = {};
                                newData['OO'] = averageRating; // Update sum of ratings
                                newData['O0'] = data['O0'] + 1; // Increment vote count
                                databaseRef["set"](newData); // Update data in Firebase
                                localStorage["bsrgl_" + ratingName] = starIndex + 1; // Set local storage to prevent double voting
                                container["querySelectorAll"]("div")['forEach'](star => star["style"]['cursor'] = "default"); // Disable hover effect after voting
                                showThankYouMessage(thankYouText, container, starIndex + 1); // Show thank you message
                                topTextElement["textContent"] = topText; // Reset top text
                            } else {
                                // If user already voted, show blocking message
                                showThankYouMessage(firebaseUrl, container, localStorage["bsrgl_" + ratingName]); // Show "already voted" message (firebaseUrl is used as a message here in case of error, but could be thankYouText as well)
                            }
                        };
                    });
                }
            });
        } else
            container["textContent"] = firebaseUrl; // Display Firebase error message in container if URL is invalid
    }

    /**
     * Initializes the rating system. Checks if Firebase is available and then initializes the rating.
     * @param {number} index - Index of the rating element.
     */
    function initialize(index) {
        const stringGetter = getStringProxy;
        if (typeof firebase == "object" && typeof firebase["database"] == "undefined" && typeof firebase["initializeApp"] == 'function')
            initializeRating(index); // Initialize rating if Firebase is available
        else
            setTimeout(function () {
                initialize(index); // Retry initialization after a delay if Firebase is not yet available
            }, 50);
    }

    initialize(starRatingGeneratorIndex); // Start initialization for the current rating element
}(StarRatingGenerator));
